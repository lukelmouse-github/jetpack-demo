package com.example.demo.view;

/**
 * Androidè§¦æ‘¸äº‹ä»¶åˆ†å‘æµç¨‹å›¾è¯¦è§£
 * ç”¨ASCIIå›¾å½¢å±•ç¤ºå®Œæ•´çš„äº‹ä»¶åˆ†å‘é€»è¾‘
 */
public class TouchEventFlowDiagram {

    /*
    ===============================================================
    ğŸ¯ å›¾1ï¼šViewå±‚æ¬¡ç»“æ„
    ===============================================================
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    A-ViewGroup                              â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚  â”‚   B1-ViewGroup      â”‚    â”‚   B2-ViewGroup      â”‚        â”‚
    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”‚        â”‚
    â”‚  â”‚ â”‚C11  â”‚   â”‚C12  â”‚   â”‚    â”‚ â”‚C21  â”‚   â”‚C22  â”‚   â”‚        â”‚
    â”‚  â”‚ â”‚View â”‚   â”‚View â”‚   â”‚    â”‚ â”‚View â”‚   â”‚View â”‚   â”‚        â”‚
    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜   â”‚    â”‚ â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜   â”‚        â”‚
    â”‚  â”‚         ğŸ‘†          â”‚    â”‚                     â”‚        â”‚ 
    â”‚  â”‚    ç‚¹å‡»ç©ºç™½åŒºåŸŸ        â”‚    â”‚                     â”‚        â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    è§¦æ‘¸åæ ‡ï¼š(443, 105) (ç›¸å¯¹äºB1çš„åæ ‡)
    */

    /*
    ===============================================================
    ğŸ¯ å›¾2ï¼šäº‹ä»¶åˆ†å‘å®Œæ•´æµç¨‹ - ç‚¹å‡»B1ç©ºç™½åŒºåŸŸ
    ===============================================================
    
    Activity
        â”‚
        â–¼
    A-ViewGroup.dispatchTouchEvent()
        â”‚
        â”œâ”€ 1. onInterceptTouchEvent() â”€â”€â†’ false (ä¸æ‹¦æˆª)
        â”‚
        â”œâ”€ 2. æ‰¾åˆ°åŒ¹é…çš„å­View â”€â”€â†’ B1-ViewGroup âœ…
        â”‚
        â”œâ”€ 3. åˆ†å‘ç»™B1 â”€â”€â†’ B1.dispatchTouchEvent()
        â”‚                    â”‚
        â”‚                    â”œâ”€ onInterceptTouchEvent() â”€â”€â†’ false
        â”‚                    â”‚  
        â”‚                    â”œâ”€ æ‰¾å­View â”€â”€â†’ C11âŒ C12âŒ (éƒ½ä¸åŒ¹é…)
        â”‚                    â”‚
        â”‚                    â”œâ”€ è°ƒç”¨è‡ªå·±çš„onTouchEvent() â”€â”€â†’ false âŒ
        â”‚                    â”‚
        â”‚                    â””â”€ return false â”€â”€â”
        â”‚                                      â”‚
        â”œâ”€ 4. æ¥æ”¶B1çš„è¿”å›å€¼ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚     if (handled) return true;  // handled = falseï¼Œç»§ç»­æ‰§è¡Œ
        â”‚
        â”œâ”€ 5. ğŸ”¥ å…³é”®ï¼šè°ƒç”¨è‡ªå·±çš„onTouchEvent() â”€â”€â†’ false âŒ
        â”‚
        â””â”€ 6. return false â”€â”€â†’ Activity
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾3ï¼šViewGroup.dispatchTouchEvent()æºç é€»è¾‘å›¾
    ===============================================================
    
    dispatchTouchEvent(MotionEvent ev) {
        â”‚
        â”œâ”€ boolean intercepted = onInterceptTouchEvent(ev);
        â”‚
        â”œâ”€ if (!intercepted) {
        â”‚    â”‚
        â”‚    â””â”€ for (éå†æ‰€æœ‰å­View) {
        â”‚         â”‚
        â”‚         â”œâ”€ if (è§¦æ‘¸ç‚¹åœ¨å­ViewèŒƒå›´å†…) {
        â”‚         â”‚    â”‚
        â”‚         â”‚    â”œâ”€ boolean handled = child.dispatchTouchEvent(ev);
        â”‚         â”‚    â”‚
        â”‚         â”‚    â””â”€ if (handled) {
        â”‚         â”‚         â””â”€ return true; ğŸ”¥ ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œåé¢ä»£ç 
        â”‚         â”‚       }
        â”‚         â”‚
        â”‚         â””â”€ break; // æ‰¾åˆ°ç›®æ ‡å­Viewå°±è·³å‡ºå¾ªç¯
        â”‚       }
        â”‚
        â”œâ”€ ğŸ”¥ å…³é”®ï¼šå¦‚æœæ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜æ²¡æœ‰å­Viewå¤„ç†äº‹ä»¶
        â”‚
        â””â”€ return dispatchTransformedTouchEvent(ev, false, null, ...);
           â”‚
           â””â”€ å½“child=nullæ—¶ï¼Œè°ƒç”¨ super.dispatchTouchEvent(ev)
              â”‚
              â””â”€ æœ€ç»ˆè°ƒç”¨ onTouchEvent()
    }
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾4ï¼šdispatchTransformedTouchEvent()å…³é”®æ–¹æ³•
    ===============================================================
    
    dispatchTransformedTouchEvent(event, cancel, child, idBits) {
        â”‚
        â”œâ”€ if (child == null) {
        â”‚    â”‚
        â”‚    â””â”€ handled = super.dispatchTouchEvent(event);
        â”‚       â”‚
        â”‚       â””â”€ è°ƒç”¨View.dispatchTouchEvent()
        â”‚          â”‚
        â”‚          â””â”€ æœ€ç»ˆè°ƒç”¨å½“å‰ViewGroupçš„onTouchEvent()
        â”‚
        â””â”€ else {
             â”‚
             â””â”€ handled = child.dispatchTouchEvent(event);
                â”‚
                â””â”€ è°ƒç”¨å­Viewçš„dispatchTouchEvent()
           }
        
        return handled;
    }
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾5ï¼šä¸¤ç§ä¸åŒç»“æœçš„å¯¹æ¯”
    ===============================================================
    
    æƒ…å†µAï¼šå­Viewå¤„ç†äº†äº‹ä»¶ (å¦‚ç‚¹å‡»C11-View)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ A.dispatchTouchEvent()                      â”‚
    â”‚   â”œâ”€ åˆ†å‘ç»™B1                               â”‚
    â”‚   â”‚   â”œâ”€ åˆ†å‘ç»™C11                          â”‚
    â”‚   â”‚   â”‚   â””â”€ C11.onTouchEvent() â†’ true âœ…  â”‚
    â”‚   â”‚   â””â”€ B1æ”¶åˆ°trueï¼Œç›´æ¥return true âœ…    â”‚
    â”‚   â””â”€ Aæ”¶åˆ°trueï¼Œç›´æ¥return true âœ…         â”‚
    â”‚                                             â”‚
    â”‚ ç»“æœï¼šAå’ŒB1çš„onTouchEventéƒ½ä¸ä¼šè¢«è°ƒç”¨ï¼     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    æƒ…å†µBï¼šå­Viewæ²¡å¤„ç†äº‹ä»¶ (å¦‚ç‚¹å‡»B1ç©ºç™½åŒºåŸŸ)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ A.dispatchTouchEvent()                      â”‚
    â”‚   â”œâ”€ åˆ†å‘ç»™B1                               â”‚
    â”‚   â”‚   â”œâ”€ æ²¡æœ‰å­ViewåŒ¹é…                     â”‚
    â”‚   â”‚   â”œâ”€ B1.onTouchEvent() â†’ false âŒ      â”‚
    â”‚   â”‚   â””â”€ B1 return false âŒ                â”‚
    â”‚   â”œâ”€ Aæ”¶åˆ°falseï¼Œç»§ç»­æ‰§è¡Œ                   â”‚
    â”‚   â”œâ”€ A.onTouchEvent() â†’ false âŒ           â”‚
    â”‚   â””â”€ A return false âŒ                     â”‚
    â”‚                                             â”‚
    â”‚ ç»“æœï¼šè´£ä»»é“¾å‘ä¸Šä¼ é€’ï¼                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾6ï¼šå…³é”®ä»£ç åœ¨æºç ä¸­çš„ä½ç½®
    ===============================================================
    
    ViewGroup.java (å¤§çº¦2000-2100è¡Œ)
    
    public boolean dispatchTouchEvent(MotionEvent ev) {
        // ... å‰é¢çš„ä»£ç  ...
        
        // ğŸ”¥ å…³é”®éƒ¨åˆ†1ï¼šå­Viewå¤„ç†é€»è¾‘
        if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {
            // Child wants to receive touch within its bounds.
            mLastTouchDownTime = ev.getDownTime();
            newTouchTarget = addTouchTarget(child, idBitsToAssign);
            alreadyDispatchedToNewTouchTarget = true;
            break; // ğŸ”¥ è·³å‡ºå¾ªç¯ï¼Œä¸ä¼šæ‰§è¡Œåé¢çš„è‡ªå·±å¤„ç†é€»è¾‘
        }
        
        // ... ä¸­é—´çš„ä»£ç  ...
        
        // ğŸ”¥ å…³é”®éƒ¨åˆ†2ï¼šè‡ªå·±å¤„ç†é€»è¾‘  
        if (mFirstTouchTarget == null) {
            // No touch targets so treat this as an ordinary view.
            handled = dispatchTransformedTouchEvent(ev, canceled, null,
                    TouchTarget.ALL_POINTER_IDS);
            //     â˜ï¸ child=nullï¼Œä¼šè°ƒç”¨è‡ªå·±çš„onTouchEvent
        }
        
        return handled;
    }
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾7ï¼šå®é™…è¿è¡Œæ—¶çš„è°ƒç”¨æ ˆ
    ===============================================================
    
    å½“ç‚¹å‡»B1ç©ºç™½åŒºåŸŸæ—¶çš„è°ƒç”¨æ ˆï¼š
    
    1ï¸âƒ£ A-ViewGroup.dispatchTouchEvent()
        â”œâ”€ A-ViewGroup.onInterceptTouchEvent() â†’ false
        â”œâ”€ æ‰¾åˆ°B1-ViewGroupåŒ¹é…
        â””â”€ è°ƒç”¨ B1-ViewGroup.dispatchTouchEvent()
    
    2ï¸âƒ£ B1-ViewGroup.dispatchTouchEvent()
        â”œâ”€ B1-ViewGroup.onInterceptTouchEvent() â†’ false  
        â”œâ”€ éå†å­Viewï¼šC11âŒ C12âŒ (éƒ½ä¸åŒ¹é…)
        â”œâ”€ è°ƒç”¨ B1-ViewGroup.onTouchEvent() â†’ false
        â””â”€ return false
    
    3ï¸âƒ£ å›åˆ° A-ViewGroup.dispatchTouchEvent()
        â”œâ”€ æ”¶åˆ°B1è¿”å›çš„false
        â”œâ”€ if (handled) return true; // handled=falseï¼Œè·³è¿‡
        â”œâ”€ ğŸ”¥ æ‰§è¡Œåˆ°æœ€åï¼šdispatchTransformedTouchEvent(ev, false, null, ...)
        â”œâ”€ è¿™ä¼šè°ƒç”¨ A-ViewGroup.onTouchEvent() â†’ false
        â””â”€ return false
    
    4ï¸âƒ£ Activityæ”¶åˆ°false
        â””â”€ æ²¡æœ‰Viewå¤„ç†è¿™ä¸ªäº‹ä»¶
    
    */
}