package com.example.demo.view;

/**
 * TouchTargetåŠ¨æ€ç®¡ç†æœºåˆ¶è¯¦è§£
 * å½“å­Viewåœ¨ä¸­é€”è¿”å›falseæ—¶ï¼Œç³»ç»Ÿå¦‚ä½•å¤„ç†TouchTargeté“¾è¡¨
 */
public class TouchTargetDynamicManagement {

    /*
    ===============================================================
    ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šå­Viewä¸­é€”è¿”å›falseä¼šæ€æ ·ï¼Ÿ
    ===============================================================
    
    åœºæ™¯ï¼šC12-Viewåœ¨DOWNæ—¶è¿”å›trueï¼Œä½†åœ¨MOVEæ—¶è¿”å›false
    
    ç­”æ¡ˆï¼š
    1. ç³»ç»Ÿä¼šç«‹å³å°†C12ä»TouchTargeté“¾è¡¨ä¸­ç§»é™¤
    2. åç»­çš„MOVE/UPäº‹ä»¶ä¸ä¼šå†å‘ç»™C12
    3. çˆ¶ViewGroupå¯èƒ½ä¼šæ¥æ”¶åˆ°è¿™äº›"å­¤å„¿äº‹ä»¶"
    4. æ•´ä¸ªæ‰‹åŠ¿åºåˆ—çš„çŠ¶æ€ç®¡ç†å˜å¾—å¤æ‚
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾1ï¼šæ­£å¸¸æµç¨‹ vs ä¸­é€”è¿”å›falseçš„å¯¹æ¯”
    ===============================================================
    
    æ­£å¸¸æµç¨‹ï¼ˆä¸€ç›´è¿”å›trueï¼‰ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ DOWN:  A â†’ B1 â†’ C12 â†’ true âœ…               â”‚
    â”‚        addTouchTarget(C12)                  â”‚
    â”‚        mFirstTouchTarget â†’ [C12-Target]     â”‚
    â”‚                                             â”‚
    â”‚ MOVE1: A â†’ B1 â†’ C12 â†’ true âœ…               â”‚
    â”‚        ç»§ç»­ä½¿ç”¨TouchTarget                   â”‚
    â”‚                                             â”‚
    â”‚ MOVE2: A â†’ B1 â†’ C12 â†’ true âœ…               â”‚
    â”‚        ç»§ç»­ä½¿ç”¨TouchTarget                   â”‚
    â”‚                                             â”‚
    â”‚ UP:    A â†’ B1 â†’ C12 â†’ true âœ…               â”‚
    â”‚        resetTouchState()                    â”‚
    |        mFirstTouchTarget = null             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    ä¸­é€”è¿”å›falseçš„æµç¨‹ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ DOWN:  A â†’ B1 â†’ C12 â†’ true âœ…               â”‚
    â”‚        addTouchTarget(C12)                  â”‚
    â”‚        mFirstTouchTarget â†’ [C12-Target]     â”‚
    â”‚                                             â”‚
    â”‚ MOVE1: A â†’ B1 â†’ C12 â†’ false âŒ             â”‚
    â”‚        ğŸ”¥ removeTouchTarget(C12)            â”‚
    â”‚        mFirstTouchTarget = null             â”‚
    â”‚                                             â”‚
    â”‚ MOVE2: ğŸš« ä¸å†å‘ç»™C12                       â”‚
    â”‚        A.onTouchEvent() æˆ– B1.onTouchEvent() â”‚
    â”‚                                             â”‚
    â”‚ UP:    ğŸš« ä¸å†å‘ç»™C12                       â”‚
    â”‚        A.onTouchEvent() æˆ– B1.onTouchEvent() â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾2ï¼šremoveTouchTarget()æœºåˆ¶è¯¦è§£
    ===============================================================
    
    å½“C12åœ¨MOVEäº‹ä»¶ä¸­è¿”å›falseæ—¶ï¼š
    
    B1-ViewGroup.dispatchTouchEvent() {
        â”‚
        â”œâ”€ TouchTarget target = mFirstTouchTarget;
        â”‚
        â”œâ”€ while (target != null) {
        â”‚    â”‚
        â”‚    â”œâ”€ if (dispatchTransformedTouchEvent(ev, false, C12, idBits)) {
        â”‚    â”‚    â””â”€ handled = true; // C12è¿”å›trueçš„æƒ…å†µ
        â”‚    â”‚  } else {
        â”‚    â”‚    â”‚
        â”‚    â”‚    â”œâ”€ // ğŸ”¥ C12è¿”å›falseï¼éœ€è¦ç§»é™¤TouchTarget
        â”‚    â”‚    â”‚
        â”‚    â”‚    â”œâ”€ if (å‰ä¸€ä¸ªèŠ‚ç‚¹ == null) {
        â”‚    â”‚    â”‚    mFirstTouchTarget = target.next; // ç§»é™¤å¤´èŠ‚ç‚¹
        â”‚    â”‚    â”‚  } else {
        â”‚    â”‚    â”‚    å‰ä¸€ä¸ªèŠ‚ç‚¹.next = target.next; // ç§»é™¤ä¸­é—´èŠ‚ç‚¹
        â”‚    â”‚    â”‚  }
        â”‚    â”‚    â”‚
        â”‚    â”‚    â”œâ”€ target.recycle(); // å›æ”¶TouchTargetå¯¹è±¡
        â”‚    â”‚    â”‚
        â”‚    â”‚    â””â”€ target = next; // ç»§ç»­éå†ä¸‹ä¸€ä¸ª
        â”‚    â”‚  }
        â”‚    â”‚
        â”‚    â””â”€ target = target.next;
        â”‚  }
        â”‚
        â””â”€ return handled;
    }
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾3ï¼šé“¾è¡¨åŠ¨æ€å˜åŒ–è¿‡ç¨‹
    ===============================================================
    
    åˆå§‹çŠ¶æ€ï¼ˆDOWNäº‹ä»¶åï¼‰ï¼š
    mFirstTouchTarget â†’ [C12-Target] â†’ null
    
    MOVEäº‹ä»¶ä¸­C12è¿”å›falseï¼š
    â”œâ”€ dispatchTransformedTouchEvent(C12) â†’ false
    â”œâ”€ æ£€æµ‹åˆ°è¿”å›falseï¼Œæ‰§è¡Œç§»é™¤æ“ä½œ
    â”œâ”€ mFirstTouchTarget = target.next (null)
    â””â”€ target.recycle()
    
    ç§»é™¤åï¼š
    mFirstTouchTarget â†’ null
    
    å¤šä¸ªTouchTargetçš„æƒ…å†µï¼š
    
    åˆå§‹ï¼šmFirstTouchTarget â†’ [C12-Target] â†’ [C11-Target] â†’ null
    
    C11è¿”å›falseï¼š
    â”œâ”€ æ‰¾åˆ°C11å¯¹åº”çš„TouchTarget
    â”œâ”€ C12-Target.next = C11-Target.next (null)
    â””â”€ C11-Target.recycle()
    
    ç»“æœï¼šmFirstTouchTarget â†’ [C12-Target] â†’ null
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾4ï¼šæºç ä¸­çš„å…³é”®é€»è¾‘
    ===============================================================
    
    ViewGroup.dispatchTouchEvent()ä¸­å¤„ç†å­Viewè¿”å›falseçš„é€»è¾‘ï¼š
    
    TouchTarget predecessor = null;
    TouchTarget target = mFirstTouchTarget;
    
    while (target != null) {
        final TouchTarget next = target.next;
        
        if (dispatchTransformedTouchEvent(ev, cancelChild,
                target.child, target.pointerIdBits)) {
            handled = true; // å­Viewå¤„ç†äº†äº‹ä»¶
        } else {
            // ğŸ”¥ å­Viewè¿”å›falseï¼Œéœ€è¦ç§»é™¤TouchTarget
            if (predecessor == null) {
                mFirstTouchTarget = next; // ç§»é™¤å¤´èŠ‚ç‚¹
            } else {
                predecessor.next = next; // ç§»é™¤ä¸­é—´èŠ‚ç‚¹
            }
            target.recycle(); // å›æ”¶å¯¹è±¡
            target = next; // è·³åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
            continue; // ä¸æ›´æ–°predecessor
        }
        
        predecessor = target; // è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹
        target = next;
    }
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾5ï¼šåç»­äº‹ä»¶çš„å¤„ç†æ–¹å¼
    ===============================================================
    
    å½“TouchTargeté“¾è¡¨ä¸ºç©ºåï¼Œåç»­äº‹ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ
    
    æƒ…å†µ1ï¼šmFirstTouchTarget == null
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ViewGroup.dispatchTouchEvent() {            â”‚
    â”‚   if (mFirstTouchTarget == null) {          â”‚
    â”‚     // ğŸ”¥ æ²¡æœ‰TouchTargetï¼Œå½“ä½œæ™®é€šViewå¤„ç†  â”‚
    â”‚     handled = dispatchTransformedTouchEvent(â”‚
    â”‚         ev, canceled, null, ...);           â”‚
    â”‚     // â˜ï¸ è°ƒç”¨è‡ªå·±çš„onTouchEvent()          â”‚
    â”‚   }                                         â”‚
    â”‚ }                                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    è¿™æ„å‘³ç€ï¼š
    â€¢ åç»­MOVE/UPäº‹ä»¶ä¼šåˆ†å‘ç»™çˆ¶ViewGroupè‡ªå·±å¤„ç†
    â€¢ å¦‚æœçˆ¶ViewGroupçš„onTouchEvent()è¿”å›trueï¼Œäº‹ä»¶è¢«æ¶ˆè´¹
    â€¢ å¦‚æœçˆ¶ViewGroupçš„onTouchEvent()è¿”å›falseï¼Œç»§ç»­å‘ä¸Šä¼ é€’
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾6ï¼šå®Œæ•´çš„äº‹ä»¶åºåˆ—ç¤ºä¾‹
    ===============================================================
    
    å®é™…åœºæ™¯ï¼šç”¨æˆ·æŒ‰ä¸‹C12ï¼Œç„¶åæ‹–åŠ¨ï¼ŒC12åœ¨ç¬¬2æ¬¡MOVEæ—¶"ä¸æƒ³è¦"è¿™ä¸ªäº‹ä»¶äº†
    
    ğŸ“± DOWNäº‹ä»¶ï¼š
    â”œâ”€ A â†’ B1 â†’ C12.onTouchEvent() â†’ true âœ…
    â”œâ”€ addTouchTarget(C12)
    â””â”€ mFirstTouchTarget â†’ [C12-Target]
    
    ğŸ“± MOVEäº‹ä»¶1ï¼š
    â”œâ”€ Aæ£€æŸ¥mFirstTouchTarget != null âœ…
    â”œâ”€ ç›´æ¥åˆ†å‘ç»™C12 â†’ C12.onTouchEvent() â†’ true âœ…
    â””â”€ é“¾è¡¨ä¿æŒä¸å˜
    
    ğŸ“± MOVEäº‹ä»¶2ï¼š
    â”œâ”€ Aæ£€æŸ¥mFirstTouchTarget != null âœ…
    â”œâ”€ ç›´æ¥åˆ†å‘ç»™C12 â†’ C12.onTouchEvent() â†’ false âŒ
    â”œâ”€ ğŸ”¥ removeTouchTarget(C12)
    â””â”€ mFirstTouchTarget = null
    
    ğŸ“± MOVEäº‹ä»¶3ï¼š
    â”œâ”€ Aæ£€æŸ¥mFirstTouchTarget == null âŒ
    â”œâ”€ ğŸ”„ fallbackåˆ°çˆ¶ViewGroupå¤„ç†
    â”œâ”€ B1.onTouchEvent() â†’ false (å‡è®¾)
    â””â”€ A.onTouchEvent() â†’ false (å‡è®¾)
    
    ğŸ“± UPäº‹ä»¶ï¼š
    â”œâ”€ Aæ£€æŸ¥mFirstTouchTarget == null âŒ
    â”œâ”€ ğŸ”„ fallbackåˆ°çˆ¶ViewGroupå¤„ç†
    â”œâ”€ B1.onTouchEvent() â†’ false
    â””â”€ A.onTouchEvent() â†’ false
    
    ğŸ¯ ç»“æœï¼šåç»­äº‹ä»¶éƒ½ä¸ä¼šå†å‘ç»™C12äº†ï¼
    
    */

    /*
    ===============================================================
    ğŸ¯ å›¾7ï¼šå®é™…åº”ç”¨åœºæ™¯
    ===============================================================
    
    è¿™ç§æœºåˆ¶åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨ï¼š
    
    1. ğŸ¯ æ»‘åŠ¨å†²çªè§£å†³ï¼š
       â€¢ å­Viewå¼€å§‹å¤„ç†è§¦æ‘¸äº‹ä»¶
       â€¢ æ£€æµ‹åˆ°çˆ¶ViewGroupéœ€è¦æ»‘åŠ¨æ—¶è¿”å›false
       â€¢ çˆ¶ViewGroupæ¥ç®¡åç»­äº‹ä»¶è¿›è¡Œæ»‘åŠ¨
    
    2. ğŸ¨ åŠ¨æ€æ‰‹åŠ¿è¯†åˆ«ï¼š
       â€¢ Viewå¼€å§‹å“åº”è§¦æ‘¸
       â€¢ å‘ç°ä¸æ˜¯ç›®æ ‡æ‰‹åŠ¿æ—¶"æ”¾å¼ƒå¤„ç†"
       â€¢ è®©å…¶ä»–Viewæˆ–çˆ¶ViewGroupæ¥æ‰‹
    
    3. ğŸ”„ çŠ¶æ€å˜åŒ–å“åº”ï¼š
       â€¢ Viewåœ¨æŸç§çŠ¶æ€ä¸‹å¤„ç†äº‹ä»¶
       â€¢ çŠ¶æ€æ”¹å˜åä¸å†å¤„ç†åŒä¸€æ‰‹åŠ¿åºåˆ—
       â€¢ ä¼˜é›…åœ°è½¬ç§»äº‹ä»¶å¤„ç†æƒ
    
    4. âš¡ æ€§èƒ½ä¼˜åŒ–ï¼š
       â€¢ åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„TouchTarget
       â€¢ é¿å…æ— æ•ˆçš„äº‹ä»¶åˆ†å‘
       â€¢ å‡å°‘å†…å­˜å ç”¨
    
    */

    /*
    ===============================================================
    ğŸ¯ å…³é”®ç†è§£ç‚¹
    ===============================================================
    
    1. ğŸ”„ åŠ¨æ€æ€§ï¼š
       â€¢ TouchTargeté“¾è¡¨æ˜¯åŠ¨æ€çš„ï¼Œéšæ—¶å¯èƒ½å˜åŒ–
       â€¢ Viewå¯ä»¥åœ¨ä»»ä½•æ—¶å€™"é€€å‡º"äº‹ä»¶å¤„ç†
       â€¢ ç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒæ•´äº‹ä»¶åˆ†å‘è·¯å¾„
    
    2. ğŸ¯ ä¸€è‡´æ€§åŸåˆ™ï¼š
       â€¢ ä¸€æ—¦Viewè¿”å›falseï¼Œç«‹å³ä»é“¾è¡¨ä¸­ç§»é™¤
       â€¢ åç»­äº‹ä»¶ä¸ä¼šå†å‘ç»™è¿™ä¸ªView
       â€¢ ä¿è¯äº‹ä»¶åˆ†å‘çš„ç¡®å®šæ€§
    
    3. ğŸ”’ ä¸å¯é€†æ€§ï¼š
       â€¢ ä¸€æ—¦ä»TouchTargeté“¾è¡¨ä¸­ç§»é™¤ï¼Œæ— æ³•é‡æ–°åŠ å…¥
       â€¢ åŒä¸€æ‰‹åŠ¿åºåˆ—ä¸­ï¼ŒViewåªæœ‰ä¸€æ¬¡"é€‰æ‹©æœºä¼š"
       â€¢ é˜²æ­¢äº‹ä»¶å¤„ç†çš„æ··ä¹±
    
    4. ğŸ›¡ï¸ å…œåº•æœºåˆ¶ï¼š
       â€¢ å½“é“¾è¡¨ä¸ºç©ºæ—¶ï¼Œçˆ¶ViewGroupæ¥ç®¡å¤„ç†
       â€¢ ç¡®ä¿äº‹ä»¶ä¸ä¼šä¸¢å¤±
       â€¢ ç»´æŠ¤æ•´ä½“çš„äº‹ä»¶åˆ†å‘é€»è¾‘
    
    */
}