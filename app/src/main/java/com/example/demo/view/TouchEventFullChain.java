package com.example.demo.view;

/**
 * Androidè§¦æ‘¸äº‹ä»¶å®Œæ•´ä¼ é€’é“¾è·¯
 * ä»ç¡¬ä»¶åº•å±‚åˆ°åº”ç”¨å±‚Viewçš„å®Œæ•´æµç¨‹
 */
public class TouchEventFullChain {

    /*
    ===============================================================
    ğŸ”¥ Androidè§¦æ‘¸äº‹ä»¶å®Œæ•´ä¼ é€’é“¾è·¯ ğŸ”¥
    ===============================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ–±ï¸ ç¬¬1å±‚ï¼šç¡¬ä»¶å±‚ (Hardware Layer)                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    ç”¨æˆ·æ‰‹æŒ‡è§¦æ‘¸å±å¹•
    â†“
    è§¦æ‘¸å±ç¡¬ä»¶ (Touch Panel) æ£€æµ‹åˆ°å‹åŠ›/ç”µå®¹å˜åŒ–
    â†“
    ç¡¬ä»¶äº§ç”Ÿä¸­æ–­ä¿¡å· (Hardware Interrupt)
    â†“
    è§¦æ‘¸é©±åŠ¨ç¨‹åº (Touch Driver) è¯»å–åæ ‡æ•°æ®


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ§ ç¬¬2å±‚ï¼šLinuxå†…æ ¸å±‚ (Kernel Layer)                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    è§¦æ‘¸é©±åŠ¨å°†æ•°æ®å†™å…¥ /dev/input/eventX è®¾å¤‡èŠ‚ç‚¹
    â†“
    Linux Inputå­ç³»ç»Ÿå¤„ç†åŸå§‹è¾“å…¥æ•°æ®
    â†“
    å†…æ ¸å°†è§¦æ‘¸äº‹ä»¶æ”¾å…¥è¾“å…¥äº‹ä»¶é˜Ÿåˆ—
    â†“
    é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥å£æš´éœ²ç»™ç”¨æˆ·ç©ºé—´


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âš¡ ç¬¬3å±‚ï¼šNativeå±‚ (Native/C++ Layer)                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    InputManagerService (C++) è½®è¯¢ /dev/input/ è®¾å¤‡
    â†“
    InputReader è¯»å–åŸå§‹è¾“å…¥äº‹ä»¶
    â†“  
    InputDispatcher åˆ†å‘å¤„ç†åçš„äº‹ä»¶
    â†“
    é€šè¿‡Binder IPCå‘é€åˆ°åº”ç”¨è¿›ç¨‹


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ â˜• ç¬¬4å±‚ï¼šFrameworkå±‚ (Java Framework)                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    WindowManagerService æ¥æ”¶åˆ°è¾“å…¥äº‹ä»¶
    â†“
    ç¡®å®šäº‹ä»¶åº”è¯¥å‘é€ç»™å“ªä¸ªWindow
    â†“
    é€šè¿‡InputChannelå‘é€åˆ°ç›®æ ‡åº”ç”¨çš„ä¸»çº¿ç¨‹
    â†“
    ViewRootImpl.dispatchInputEvent() æ¥æ”¶äº‹ä»¶
    â†“
    ViewRootImpl.deliverPointerEvent() å¤„ç†è§¦æ‘¸äº‹ä»¶
    â†“
    åˆ›å»ºMotionEventå¯¹è±¡


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ“± ç¬¬5å±‚ï¼šåº”ç”¨å±‚ (Application Layer)                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    ViewRootImpl.dispatchTouchEvent()
    â†“
    Activity.dispatchTouchEvent()  â† è¿›å…¥åº”ç”¨ä»£ç ï¼
    â†“
    PhoneWindow.superDispatchTouchEvent()
    â†“  
    DecorView.superDispatchTouchEvent()
    â†“
    ViewGroupå±‚å±‚åˆ†å‘ (æˆ‘ä»¬demoæ¼”ç¤ºçš„éƒ¨åˆ†)
    â†“
    æœ€ç»ˆåˆ°è¾¾å…·ä½“çš„View.onTouchEvent()

    */

    // ===============================================================
    // ğŸ¯ å…³é”®ç»„ä»¶è¯¦ç»†è¯´æ˜
    // ===============================================================

    /**
     * 1. ç¡¬ä»¶å±‚è¯¦è§£
     */
    private void hardwareLayerDetail() {
        /*
        ğŸ“± è§¦æ‘¸å±ç±»å‹:
        â€¢ ç”µé˜»å¼è§¦æ‘¸å±: é€šè¿‡å‹åŠ›æ„Ÿåº”
        â€¢ ç”µå®¹å¼è§¦æ‘¸å±: é€šè¿‡ç”µå®¹å˜åŒ–ï¼ˆç°ä»£æ‰‹æœºä¸»æµï¼‰
        
        ğŸ”Œ ç¡¬ä»¶ä¸­æ–­:
        â€¢ è§¦æ‘¸æ—¶äº§ç”ŸIRQä¸­æ–­
        â€¢ ä¸­æ–­å¤„ç†ç¨‹åºè¯»å–ADCè½¬æ¢åçš„åæ ‡å€¼
        â€¢ ç¡¬ä»¶å»æŠ–åŠ¨å’Œæ»¤æ³¢
        
        ğŸ“Š åŸå§‹æ•°æ®:
        â€¢ X, Yåæ ‡
        â€¢ å‹åŠ›å€¼
        â€¢ æ—¶é—´æˆ³
        â€¢ è§¦æ‘¸é¢ç§¯
        */
    }

    /**
     * 2. å†…æ ¸å±‚è¯¦è§£  
     */
    private void kernelLayerDetail() {
        /*
        ğŸ§ Linux Inputå­ç³»ç»Ÿ:
        /dev/input/event0  - è§¦æ‘¸å±è®¾å¤‡
        /dev/input/event1  - æŒ‰é”®è®¾å¤‡
        /dev/input/event2  - å…¶ä»–è¾“å…¥è®¾å¤‡
        
        ğŸ“‹ äº‹ä»¶ç»“æ„ (input_event):
        struct input_event {
            struct timeval time;  // æ—¶é—´æˆ³
            __u16 type;          // äº‹ä»¶ç±»å‹ (EV_ABS)
            __u16 code;          // äº‹ä»¶ä»£ç  (ABS_X, ABS_Y)
            __s32 value;         // äº‹ä»¶å€¼ (åæ ‡å€¼)
        };
        
        ğŸ”„ å¤„ç†æµç¨‹:
        1. é©±åŠ¨å†™å…¥äº‹ä»¶åˆ°è®¾å¤‡èŠ‚ç‚¹
        2. ç”¨æˆ·ç©ºé—´ç¨‹åºread()è¯»å–
        3. epoll/selectç›‘å¬æ–‡ä»¶æè¿°ç¬¦
        */
    }

    /**
     * 3. Nativeå±‚è¯¦è§£
     */
    private void nativeLayerDetail() {
        /*
        âš¡ InputManagerServiceæ¶æ„:
        
        InputManager
        â”œâ”€â”€ InputReader (è¯»å–çº¿ç¨‹)
        â”‚   â”œâ”€â”€ EventHub (ç›‘å¬ /dev/input/)
        â”‚   â”œâ”€â”€ InputDevice (è®¾å¤‡æŠ½è±¡)
        â”‚   â””â”€â”€ InputMapper (åæ ‡æ˜ å°„)
        â””â”€â”€ InputDispatcher (åˆ†å‘çº¿ç¨‹)
            â”œâ”€â”€ InputTarget (ç›®æ ‡çª—å£)
            â”œâ”€â”€ InputChannel (é€šä¿¡ç®¡é“)
            â””â”€â”€ InputWindow (çª—å£ä¿¡æ¯)
        
        ğŸ”„ å¤„ç†æµç¨‹:
        1. EventHub.getEvents() è¯»å–å†…æ ¸äº‹ä»¶
        2. InputReader è§£æå¹¶è½¬æ¢åæ ‡
        3. InputDispatcher æ‰¾åˆ°ç›®æ ‡çª—å£
        4. é€šè¿‡InputChannelå‘é€åˆ°åº”ç”¨
        
        ğŸ¯ åæ ‡è½¬æ¢:
        â€¢ åŸå§‹åæ ‡ â†’ å±å¹•åæ ‡
        â€¢ å¤„ç†æ—‹è½¬ã€ç¼©æ”¾
        â€¢ å¤šç‚¹è§¦æ§å¤„ç†
        */
    }

    /**
     * 4. Frameworkå±‚è¯¦è§£
     */
    private void frameworkLayerDetail() {
        /*
        â˜• WindowManagerServiceèŒè´£:
        â€¢ ç®¡ç†æ‰€æœ‰çª—å£çš„å±‚çº§å…³ç³»
        â€¢ å†³å®šäº‹ä»¶åº”è¯¥å‘ç»™å“ªä¸ªçª—å£
        â€¢ å¤„ç†çª—å£ç„¦ç‚¹å’Œå¯è§æ€§
        
        ğŸ–¼ï¸ ViewRootImplå…³é”®æ–¹æ³•:
        ViewRootImpl.dispatchInputEvent()
        â”œâ”€â”€ dispatchPointerEvent()
        â”œâ”€â”€ processPointerEvent()  
        â””â”€â”€ deliverPointerEvent()
            â””â”€â”€ åˆ›å»ºMotionEvent
        
        ğŸ“‹ MotionEventåŒ…å«ä¿¡æ¯:
        â€¢ äº‹ä»¶ç±»å‹ (ACTION_DOWN/MOVE/UP)
        â€¢ åæ ‡ (x, y)
        â€¢ æ—¶é—´æˆ³
        â€¢ å‹åŠ›å€¼
        â€¢ è§¦æ‘¸é¢ç§¯
        â€¢ è®¾å¤‡ID
        */
    }

    /**
     * 5. åº”ç”¨å±‚è¯¦è§£ - æˆ‘ä»¬demoæ¼”ç¤ºçš„éƒ¨åˆ†
     */
    private void applicationLayerDetail() {
        /*
        ğŸ“± åº”ç”¨å±‚äº‹ä»¶æµ:
        
        Activity.dispatchTouchEvent()
        â†“
        if (getWindow().superDispatchTouchEvent(ev)) {
            return true; // çª—å£å¤„ç†äº†
        }
        return onTouchEvent(ev); // Activityè‡ªå·±å¤„ç†
        
        ğŸ  Windowå±‚çº§:
        PhoneWindow
        â””â”€â”€ DecorView (FrameLayout)
            â”œâ”€â”€ TitleBar (å¯é€‰)
            â””â”€â”€ ContentView
                â””â”€â”€ ç”¨æˆ·çš„å¸ƒå±€ â† æˆ‘ä»¬çš„demoåœ¨è¿™é‡Œï¼
        
        ğŸ¯ ViewGroupåˆ†å‘ (æˆ‘ä»¬demoçš„æ ¸å¿ƒ):
        AViewGroup.dispatchTouchEvent()
        â”œâ”€â”€ onInterceptTouchEvent() - æ˜¯å¦æ‹¦æˆª
        â”œâ”€â”€ æ‰¾åˆ°ç›®æ ‡å­View
        â”œâ”€â”€ è°ƒç”¨å­Viewçš„dispatchTouchEvent()
        â””â”€â”€ å¦‚æœå­Viewä¸å¤„ç†ï¼Œè°ƒç”¨è‡ªå·±çš„onTouchEvent()
        */
    }

    // ===============================================================
    // ğŸ“Š å®Œæ•´æ—¶åºå›¾
    // ===============================================================
    
    /*
    æ—¶é—´è½´: ç”¨æˆ·æŒ‰ä¸‹å±å¹•çš„é‚£ä¸€åˆ»...
    
    T+0ms:   ğŸ‘† æ‰‹æŒ‡è§¦æ‘¸å±å¹•
    T+1ms:   ğŸ”Œ ç¡¬ä»¶äº§ç”Ÿä¸­æ–­
    T+2ms:   ğŸ§ å†…æ ¸å¤„ç†ä¸­æ–­ï¼Œå†™å…¥äº‹ä»¶é˜Ÿåˆ—
    T+3ms:   âš¡ InputReaderè¯»å–äº‹ä»¶
    T+4ms:   âš¡ InputDispatcheråˆ†å‘äº‹ä»¶
    T+5ms:   ğŸ“± ViewRootImplæ¥æ”¶äº‹ä»¶
    T+6ms:   ğŸ“± Activity.dispatchTouchEvent()
    T+7ms:   ğŸ“± ViewGroupå±‚å±‚åˆ†å‘
    T+8ms:   ğŸ“± æœ€ç»ˆView.onTouchEvent()
    T+9ms:   ğŸ”„ è¿”å›å€¼å±‚å±‚å‘ä¸Šä¼ é€’
    T+10ms:  âœ… äº‹ä»¶å¤„ç†å®Œæˆ
    
    æ•´ä¸ªè¿‡ç¨‹é€šå¸¸åœ¨10-16mså†…å®Œæˆï¼ˆ60fpsçš„ä¸€å¸§æ—¶é—´ï¼‰
    */

    // ===============================================================
    // ğŸ”§ è°ƒè¯•æŠ€å·§
    // ===============================================================
    
    /*
    ğŸ› ï¸ å„å±‚è°ƒè¯•æ–¹æ³•:
    
    1. å†…æ ¸å±‚:
       cat /proc/bus/input/devices  - æŸ¥çœ‹è¾“å…¥è®¾å¤‡
       cat /dev/input/event0        - æŸ¥çœ‹åŸå§‹äº‹ä»¶
       
    2. Nativeå±‚:
       dumpsys input                - æŸ¥çœ‹InputManagerçŠ¶æ€
       
    3. Frameworkå±‚:
       dumpsys window               - æŸ¥çœ‹çª—å£ä¿¡æ¯
       
    4. åº”ç”¨å±‚:
       adb logcat | grep TouchEvent - æŸ¥çœ‹æˆ‘ä»¬çš„demoæ—¥å¿—
    */
}